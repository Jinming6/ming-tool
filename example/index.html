<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
  <style>
    html {
      background-color: black;
      color: white;
    }

    .rgbColor,
    .hexColor {
      width: 100px;
      height: 100px;
      transition: .2s;
      border-radius: 10px;
      border: 1px solid rgba(255, 255, 255, .5);
    }

    .rgb,
    .hex {
      height: 24px;
      font-size: 12px;
      line-height: 24px;
    }

    .table {
      border-collapse: collapse;

      th,
      td {
        border: 1px solid white;
      }
    }
  </style>
</head>

<body>
  <h1>Example</h1>
  <section>
    <h2>随机RGB</h2>
    <div class="rgbColor"></div>
    <div class="rgb"></div>
    <button id="randomRgbBtn">Random</button>
  </section>
  <section>
    <h2>随机HEX</h2>
    <div class="hexColor"></div>
    <div class="hex"></div>
    <button id="randomHexBtn">Random</button>
  </section>
  <section>
    <h2>下载文件</h2>
    <button id="downloadFileBtn">Download</button>
  </section>
  <section>
    <h2>转换为Webp</h2>
    <input type="file" id="fileInput" accept="image/*">
    <button id="testBtn">Test</button>
  </section>

  <script src="../dist/ming-tool.js"></script>
  <script>
    const randomRgbBtn = document.getElementById('randomRgbBtn');
    randomRgbBtn.addEventListener('click', () => {
      const color = window['@jinming6/mingTool'].getRandomRgb();
      document.querySelector('.rgb').textContent = color;
      document.querySelector('.rgbColor').style.backgroundColor = color;
    });

    const randomHexBtn = document.getElementById('randomHexBtn');
    randomHexBtn.addEventListener('click', () => {
      const color = window['@jinming6/mingTool'].getRandomHex();
      document.querySelector('.hex').textContent = color;
      document.querySelector('.hexColor').style.backgroundColor = color;
    });

    const downloadFileBtn = document.getElementById('downloadFileBtn');
    downloadFileBtn.addEventListener('click', () => {
      // const str = '大道泛兮，其可左右。';
      // const encoder = new TextEncoder();
      // const encodedData = encoder.encode(str);
      // const buffer = new ArrayBuffer(encodedData.byteLength);
      // const uint8Array = new Uint8Array(buffer);
      // uint8Array.set(encodedData);
      // window['@jinming6/mingTool'].downloadFile({
      //   inputType: 'arrayBuffer',
      //   arrayBuffer: buffer,
      //   filename: 'example.txt',
      // })


      const url = './demo.png';
      const filename = 'test.png';
      window['@jinming6/mingTool'].downloadFile({
        inputType: 'url',
        url,
        filename,
      })
    })

    const dataSource = [
      {
        label: '关闭',
        value: 0,
      },
      {
        label: '开启',
        value: 1,
      },
      {
        label: '暂停',
        value: 2,
      },
    ];
    const option = new window['@jinming6/mingTool'].Option({ dataSource });
    console.log(option)
    setTimeout(() => {
      dataSource.push({
        label: '继续',
        value: 3,
      })
      option.update({ dataSource })
      console.log(option)
    }, 1000)

    const fileInput = document.getElementById('fileInput');
    fileInput.addEventListener('change', async (e) => {
      const file = e.target.files[0];
      const blob = await window['@jinming6/mingTool'].convert2Webp(file);
      const url = URL.createObjectURL(blob);
      window['@jinming6/mingTool'].downloadFile(url, 'example.webp');
      URL.revokeObjectURL(url);
    })

    const testBtn = document.getElementById('testBtn');
    testBtn.addEventListener('click', async () => {
      try {
        const img = new Image()
        img.src = 'https://s2.loli.net/2024/04/26/z9NEnaI7lJqwrx5.png'
        img.crossOrigin = 'anonymous'
        img.onload = () => {
          const canvas = document.createElement('canvas');
          const ctx = canvas.getContext('2d');
          canvas.width = img.width;
          canvas.height = img.height;
          ctx.drawImage(img, 0, 0);
          canvas.toBlob(async (blob) => {
            const webpBlob = await window['@jinming6/mingTool'].convert2Webp(blob);
            window['@jinming6/mingTool'].downloadArrayBuffer(webpBlob, 'example.webp')
          })
        }
      } catch (e) {
        console.log(e)
      }
    })
  </script>
</body>

</html>